---
name: Pull Request
on:
  pull_request:
    branches: [main]
  workflow_dispatch:
jobs:
  # pre-commit:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - uses: actions/setup-python@v3
  #     - run: python -m pip install pre-commit
  #       shell: bash
  #     - run: python -m pip freeze --local
  #       shell: bash
  #     - uses: actions/cache@v4
  #       with:
  #         path: ~/.cache/pre-commit
  #         key: pre-commit-3|${{ env.pythonLocation }}|${{ hashFiles('.pre-commit-config.yaml') }}
  #     - run: pre-commit run --show-diff-on-failure --color=always ${{ inputs.extra_args }}
  #       shell: bash

  diff:
    runs-on: ubuntu-latest
    # needs: [pre-commit]
    steps:
      - name: Checkout source branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Set up Helm
        uses: azure/setup-helm@v4.2.0

      - name: Helm Template
        run: |
          helm dependency build ./charts/app.test
          helm template ./charts/app.test > source.k8s.yaml

      - name: Checkout target branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.base.ref }}

      - name: Helm Template
        run: |
          ls -lia
          cat source.k8s.yaml

      # - name: Helm Template
      #   run: |
      #     helm dependency build ./charts/app.test
      #     helm template ./charts/app.test > target.k8s.yaml

      # - name: Diff
      #   run: diff source.k8s.yaml target.k8s.yaml || true
